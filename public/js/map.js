// Generated by CoffeeScript 1.6.3
(function() {
  $(function() {
    window.cc = function() {
      return _.each(arguments, function(arg) {
        return console.log(arg);
      });
    };
    return window.MovieMap = Backbone.View.extend({
      el: '.wrapper',
      initialize: function() {
        this.infowindow = new google.maps.InfoWindow();
        this.mapOptions = {
          center: new google.maps.LatLng(37.7849300, -122.4294200),
          zoom: 13,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        this.map = new google.maps.Map(document.getElementsByClassName("map-canvas")[0], this.mapOptions);
        _.bindAll(this, "render");
        this.render();
        return this;
      },
      render: function() {
        var self;
        self = this;
        return this.plotMarker(this.collection.at(0));
      },
      plotMarker: function(model) {
        var index, self;
        index = 1 + model.collection.indexOf(model);
        self = this;
        return window.setTimeout(function() {
          _.each(model.get("coords").models, function(location) {
            var marker, view;
            if (location.plotted === true) {
              return true;
            }
            view = new MovieMarker({
              model: location,
              mapObj: self
            });
            marker = view.render().marker;
            self.collection.markers.push(marker);
            marker.setMap(self.map);
            google.maps.event.addListener(marker, "click", function() {
              cc(location.movies.toJSON());
              self.infowindow.setContent(_.template(view.template, {
                movies: location.movies.toJSON()
              }));
              return self.infowindow.open(self.map, this);
            });
            return location.plotted = true;
          });
          if (self.collection.length / 2 > index) {
            return self.plotMarker(self.collection.at(index));
          } else {
            return $(document.body).removeClass().find(".modal").fadeOut("slow");
          }
        }, 18);
      },
      getMatches: function(e) {
        var $t, matches, query;
        $t = $(e.currentTarget);
        query = $t.val();
        cc(query);
        matches = this.collection.search(query);
        return _.each(matches, function(match) {
          var listItem;
          listItem = new window.MovieAutoItem({
            model: match
          });
          return $(".auto-list").html(listItem.render().el);
        });
      },
      events: {
        'keyup .js-search': "getMatches",
        'keydown .js-search': "getMatches",
        'click .icon-search': function(e) {
          return e.preventDefault();
        }
      }
    });
  });

}).call(this);
