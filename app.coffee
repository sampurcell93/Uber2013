_ = require 'underscore'
express = require 'express'
app = do express
port = process.env.PORT || 6060
ObjectID = require('mongodb').ObjectID
app.listen port, ->
    console.log "now listening on port " + port
MONGO_URI = process.env.MONGOLAB_URI || process.env.MONGOHQ_URL || "Uber2013"
db = require("mongojs").connect(MONGO_URI,['locations', "movies", "testing"]);
cc = ->
    _.each arguments , (arg) ->
        console.log arg

app.configure ->
    app.use express.logger("dev")
    app.set "views", __dirname + "/views"
    app.set "view engine", "jade"
    app.use express.errorHandler()
    app.locals.pretty = true
    app.use express.cookieParser()
    app.use express.bodyParser()
    app.use express.methodOverride()
    app.use express.static(__dirname + "/public")


app.get "/", (req, res)->
    db.locations.find {}, (err, found) ->
        res.render "index"

app.post "/locations/", (req,res) ->
    # Array of properties we want input - stop DB spamming
    desired = ["locations", "actor_1", "coords", "actor_2", "actor_3", "director", "title", "fun_facts",
                "producer", "lat", "lng", "production_company", "writer", "release_year"]
    # Blank obj for insertion
    sanitized = {}
    # make sure request params are all desired
    _.each req.body, (param, key) ->
        if desired.indexOf(key) != -1
            sanitized[key] = param
    cc "posting"
    db.movies.find({title: sanitized.title}, (err, found) ->
        if found.length and sanitized.coords?
            sanitized.coords = sanitized.coords.concat found[0].coords
        if !sanitized.coords? and found.length
            sanitized.coords = found.coords
        cc sanitized.coords, sanitized.title
        db.locations.update {title: sanitized.title}, {$set: sanitized}, {upsert: true}, (err, upd) ->
            res.json success: true
    )
app.get "/movies", (req, res) ->
    db.movies.find {}, (err, found) ->
        if !err then res.json found
        else res.json success: false

app.get "/locations", (req, res) ->
    db.locations.find {}, (err, found) ->
        if !err then res.json found
        else res.json success: false

app.get "/movies/:query", (req, res) ->
    query = req.params.query


app.put "/locations/:id", (req, res) ->
    id = new ObjectID req.params.id
    res.json [success: true]

# update = (arr, title) ->
#     db.locations.update({title: title}, {$set: {coords: arr}}, ->
#         cc "======="
#         cc "just updated " + title + " with an array of length" + arr.length
#         cc arr
#         cc "======="
#     )


# app.get "/dev", (req,res) ->
#     funfacts = {"Golden Gate Park":"Golden Gate Park is similar in shape but 20% larger than New York's Central Park.","San Francisco Chronicle (901 Mission Street at 15th Street)":"The paper is called the San Francisco Globe in the movie.","Fairmont Hotel (950 Mason Street, Nob Hill)":"In 1945 the Fairmont hosted the United Nations Conference on International Organization as delegates arrived to draft a charter for the organization. The U.S. Secretary of State, Edward Stettinus drafted the charter in the hotel's Garden Room.","Embarcadero Freeway":"demolished","San Francisco International Airport":"SFO has a museum dedicated to aviation history. ","Grace Cathedral Episcopal Church (1100 California Street)":"Grace Cathedral Episcopal Church is the West Coast's largest Episcopalian cathedral.","Potrero Hill":"The crookedest street in San Fransisco is actually Potrero Hill's Vermont Street between 20th St & 22nd St.","Lefty O' Doul Drawbridge/ 3rd Street Bridge (3rd Street, China Basin)":"This is SF's only drawbridge, and was named after Francis Joseph \"Lefty\" O'Doul, a local baseball hero.","Golden Gate Bridge":"With 23 miles of ladders and 300,000 rivets in each tower, the Golden Gate Bridge was the world's longest span when it opened in 1937.","City Hall":"The dome of SF's City Hall is almost a foot taller than that of the US Capitol Building. In 1954, Joe DiMaggio and Marilyn Monroe married at the Beaux Arts-style building.","Chinatown":"First established in the mid-19th Century, SF's Chinatown is the oldest and largest Chinatown in the US.","Coit Tower":"The Tower was funded by a gift bequeathed by Lillie Hitchcock Coit, a socialite who reportedly liked to chase fires. Though the tower resembles a firehose nozzle, it was not designed this way.","Cliff House (1090 Point Lobos Avenue)":"The Musee Mechanique, which Julie Andrews' character visits in the movie, was at the time housed under the Cliff House.","Curran Theater (445 Geary Street)":"Called the Shubert Theatre in the film. ","Mel's Drive-In (Corner of Van Ness & Mission Street, Mission District)":"This restaurant location was demolished; however another Mel's was reopened in 1986 on 3355 Geary Blvd. ","Ocean Beach":"On Jan. 25, 1878, the King Philip ship crashed in Ocean Beach. Occassionally, the ship's wreckage may be found on the beach-- most recently it was seen in 2007. ","Hyde Street Cable Car":"SF Cable Cars are the only moving National Historical Landmark.","Transbay Terminal (Mission Street at 1st Street)":"Built in 1939, the Terminal linked San Francisco, the East Bay, and Sacramento by rail for the first time.","Steinhart Aquarium (California Academy of Sciences, Golden Gate Park)":"The Steinhart Aquarium is home to over 38,000 animals, which represent more than 900 species. ","Vaillancourt Fountain (Justin Herman Plaza)":"Installed in 1975, the Vaillancourt Fountain is officially titled, \"Québec Libre!\". The night before the sculpture's inauguration, artist Armand Vaillancourt inscribed \"Québec libre!\" in red letters on the sculpture. The next day when he noticed that the note had been erased, Vaillancourt jumped on the statue to reinscribe his message. ","Treasure Island":"An artificial island, Treasure Island was created for the 1939 Golden Gate International Exposition, and is named after the novel by Robert Louis Stevenson, a one-time San Francisco resident.","Postcard Row, Alamo Square, Hayes Valley":"The 6 Victorian homes across from Alamo Square Park are among the few Victorians to survive the Great Fire.","Alcatraz Island":"Alcatraz Island was a military fort before it became a prison.","St. Peter & Paul's Church (666 Filbert Street, Washington Square)":"Though Marilyn Monroe and Joe DiMaggio were not alllowed to be married at the Church (DiMaggio had married his first wife at the Church but was divorced), the couple returned to the steps of the Church for photos, following their City Hall nuptuals.","Lombard Street":"Lombard Street is not actually the crookedest in SF. That honor goes to Potrero Hill's Vermont Street between 22nd and 23rd.","Fisherman's Wharf":"Supposedly, Mikhail S. Gorbachev has said that his favorite part of visiting America was touring Fisherman's Wharf.","Ferry Building":"Every hour and half-hour, the clock bell atop the Ferry Building chimes portions of the Westminster Quarters.","Aquatic Park (Jefferson Street)":"Located at one end of Fisherman's Wharf, Aquatic Park was built as part of FDR's Works Progress Administration Project.","SF General Hospital Center (1001 Potrero Avenue, Potrero Hill)":"SF General Hospital is the only Level I Trauma Center serving San Francisco and northern San Mateo County. ","McClaren Park (Vistacon Valley)":"McClaren Park is the 2nd largest park in San Francisco, after Golden Gate Park.","Mark Hopkins Hotel (999 California Street)":"The Top of the Mark lounge and restaurant at the top of the hotel was formerly a penthouse suite.","Marina Green (Marina District)":"Before the 1906 earthquake, the land on which Marina Green sits was a tidal marsh, and rubble from the earthquake was dumped on the site. However, the site was filled in to provide land for the 1915 Panama-Pacific Exhibition. ","Kennedy Hotel (226 Embarcadero at Howard Street)":"Hotel was destroyed in the 1989 Loma Prieta earthquake. Corporate headquarters for the Gap reside at the location today.","Bay Bridge":"Before opening in 1936, the bridge was blessed by Cardinal Secretary of State Eugene Cardinal Pacelli, who later became Pope Pius XII. ","20th & Vermont Streets (Potrero Hill)":"The crookedest street in San Fransisco is actually Potrero Hill's Vermont Street between 20th St & 22nd St.","1153-57 Taylor Street":"Embarcadero Freeway, which was featured in the film was demolished in 1989 because of structural damage from the 1989 Loma Prieta Earthquake)","California Academy of Sciences (Golden Gate Park)":"Founded in 1853, 3 years after California joined the United States, the Academy was originally named the California Academy of Natural Sciences and was the first institution of its kind in the United States.","Mission Delores Park (Mission District) via J-Church MUNI Train":"The two land plots that comprise the Park were used as a Jewish cemetary until 1894 when San Francisco prohibited all burials within city limits.The graves were moved to Colma, CA.","Mission Delores (3321 16th Street, Mision District)":"Mission Delores' official name is Mission San Francisco de Asis. It is the oldest building in San Francisco, built in 1791, and has survived two major earthquakes.","The Castro":"From 1910-1920 the Castro was called \"Little Scandinavia\" because of its high concentration of residents of Scandinavian ancestry.","Twin Peaks":"The 2nd highest point in SF after Mt. Davidson, Twin Peaks sit at the geographic center of SF. The native Ohlone people called the area \"called the area “Los Pechos de la Chola” or \"Breasts of the Indian Maiden,\" but in the 19th Century when America took over the area, it was renamed \"Twin Peaks\".","Alta Plaza Park":"The park was originally a rock quarry and served as a campground for many survivors of the 1906 earthquake. The site was converted to a park in 1910.","Westin St. Francis Hotel (335 Powell Street)":"The hotel was originally supposed to be named the Crocker Hotel, after Charles Founder the railroad magnate who founded it. However, the hotel took the name the St. Francis after one of the earliest Gold Rush hotels. ","Union Square":"During the Civil War, pro-Union rallies were held in the Square, and thus the area was called \"Union Square\". ","The Embarcadero/ Ferry Building":"Every hour and half-hour, the clock bell atop the Ferry Building chimes portions of the Westminster Quarters.","Mark Hopkins Intercontinental Hotel (1 Nob Hill Circle)":"The Top of the Mark lounge and restaurant at the top of the hotel was formerly a penthouse suite.","Portsmouth Square (Chinatown)":"In 1847 the first public school in California was erected on what would become Portsmouth Square.","Mt. Davidson Cross, Mt. Davidson":"The cross sits at the highest point in San Francisco (938 feet). This version of the cross was erected in 1934.Though in Dirty Harry the cross is lit at night, the City stopped this practice in 1990.","Mission Delores Park (Mission District)":"The two land plots that comprise the Park were used as a Jewish cemetary until 1894 when San Francisco prohibited all burials within city limits.The graves were moved to Colma, CA.","Marina Green, Marina District":"Before the 1906 earthquake, the land on which Marina Green sits was a tidal marsh, and rubble from the earthquake was dumped on the site. However, the site was filled in to provide land for the 1915 Panama-Pacific Exhibition. ","Kezar Stadium, Golden Gate Park":"The stadium was demolished and completely rebuilt after sustaining damages in the 1898 Loma Prieta earthquake.","Bank of America Building (555 California Street)":"The Bank of America Building was the tallest building on the West Coast from 1969-1972, when it was surpassed by the TransAmerica Pyramid. Today, the Bank of America building is the 5th tallest building on the West Coast.","Gabbiano's Restaurant (Ferry Building)":"Every hour and half-hour, the clock bell atop the Ferry Building chimes portions of the Westminster Quarters.","Fort Point (Presidio, Golden Gate National Recreation Area)":"Built in 1853, Fort Point is the only West Coast fort built by the Union Army. Though the Confederate army planned to attack San Francisco, the commanding Confererate general learned that the war had ended while en route to SF.","West Chrissy Field (Presidio, Golden Gate National Recreation Area)":"This movie was the first to film in the revamped Chrissy Field Picnic Area.","Building 924, Presido (Golden Gate National Recreation Area)":"In 1776, Spain made the Presido a fortified area. The area was then given to Mexico, but then given to the US in 1848. The 1994 demilitarization of the area in 1994 marked the end of its 219 years of military use. ","Elbo Room (647 Valencia Street)":"This location is called the \"Café Blue Eyes\" in the film.","Baker Beach":"From 1986-1990, the north end of Baker Beach was home to the Burning Man festival.","Palace of Fine Arts (3301 Lyon Street)":"The original Palace was built for the 1915 Panama-Pacific Exposition, and completely destroyed in 1964. It was rebuilt in 1965.","North Beach Video (1398 Grant Avenue at Green)":"The video store has since moved to an adjacent location. ","Castro Theatre (429 Castro Street, The Castro)":"The original Castro Theatre was built in 1910, a few doors down from the current theatre. The original theatre was converted into retail space, and the current theatre was built in the 1920s.","Sheraton Palace Hotel (2 Montgomery Street, Financial District)":"The hotel was destroyed in the 1906 earthquake and fire, had to be rebuilt, and was reopened in 1909. ","Candlestick Park":"Then Vice President Richard Nixon threw out the first pitch when Candlestick openend in 1960. On August 29, 1966, The Beatles played their last concert for paying fans at Candlestick Park.","Nob Hill":"Railroad tycoons like Leland Stanford (founder of Stanford University) lived in Nob Hill at the turn of the 20th Century. The 1906 earthquake completely destroeyd Nob Hill, with the exception of the wall that surrounded the mansions of Stanford and his neighbor Mark Hopkins. ","2230 Sacramento Street":"Called \"1001 Franklin\" in the film.","Postcard Row (Alamo Square, Hayes Valley)":"The 6 Victorian homes across from Alamo Square Park are among the few Victorians to survive the Great Fire.","San Francisco General Hospital Medical Center (1001 Potrero Avenue, Potrero Hill)":"SF General Hospital is the only Level I Trauma Center serving San Francisco and northern San Mateo County. ","Westin St. Francis Hotel (335 Powell Street, Union Square)":"The hotel was originally supposed to be named the Crocker Hotel, after Charles Founder the railroad magnate who founded it. However, the hotel took the name the St. Francis after one of the earliest Gold Rush hotels. ","Public Health Service Hospital (Presidio, Golden Gate National Recreation Area)":"In 1776, Spain made the Presido a fortified area. The area was then given to Mexico, but then given to the US in 1848. The 1994 demilitarization of the area in 1994 marked the end of its 219 years of military use. ","Presidio, Golden Gate National Recreation Area":"In 1776, Spain made the Presido a fortified area. The area was then given to Mexico, but then given to the US in 1848. The 1994 demilitarization of the area in 1994 marked the end of its 219 years of military use. ","The Walden House, Buena Vista Park":"Established in 1867, Buena Vista Park is the oldest official park in San Francisco.","Café Trieste (609 Vallejo)":"Francis Ford Coppola allegedly wrote large portions of \"The Godfather\" trilogy in Café Trieste.","War Memorial Opera House (401 Van Ness Avenue)":"In 1945 the United Nations had its first conference at The War Memorial Opera House.","Fort Point, Presidio":"Built in 1853, Fort Point is the only West Coast fort built by the Union Army. Though the Confederate army planned to attack San Francisco, the commanding Confererate general learned that the war had ended while en route to SF.","Fort Mason (Golden Gate National Recreation Area)":"Constructed in 1864 as a coastal defense site, Fort Mason went on to serve as an army post for more than 100 years.","Asian Art Museum (200 Larkin Street, Civic Center)":"The Dalai Lama opened an exhibition on Wisdom and Compassion at the museum in 1991.","TransAmerica Pyramid (600 Montgomery Street)":"The Pyramid was the tallest skyscraper west of the Mississippi from 1972-1974, until it was surpassed by Los Angeles' Aon Center. ","Stockton Tunnel (Stockton Street at Sutter Street)":"Opened in 1914, the Stockton Tunnel was built to provide North Beach residents access to the thriving downtown area.","Candlestick Park (602 Jamestown Ave.)":"Then Vice President Richard Nixon threw out the first pitch when Candlestick openend in 1960. On August 29, 1966, The Beatles played their last concert for paying fans at Candlestick Park.","The Barbary Coast":"The Barbary Coast was a red-light district that was largely destroyed in the 1906 earthquake. Though some of the establishments were rebuilt after the earthquake, an anti-vice campaign put the establisments out of business.","Neiman Marcus (150 Stockton Street, Union Square)":"In the film the City of Paris Department Store is featured. That establishment was located where Neiman Marcus stnads today","First Bank (550 Montgomery Street at Commercial)":"Called \"Stanhope Bank\" in the film.","Ross Alley (Chinatown)":"Ross Alley is the oldest alley in San Francisco. ","Buena Vista Park (Haight Street at Buena Vista)":"Established in 1867, Buena Vista Park is the oldest official park in San Francisco.","Mel's Drive-In (Corner South Van Ness & Mission St.)":"This restaurant location was demolished; however another Mel's was reopened in 1986 on 3355 Geary Blvd. ","Conservatory of Flowers (Golden Gate Park)":"The Conservatory, unveiled in 1879, is the oldest public conservatory in the Western Hemisphere.","City Lights Bookstore (261 Columbus)":"One of the country's earliest bookstores, City Lights was founded by, and still owned by beat poet Lawrence Ferlinghetti. The bookstore was often frequented by Beat writers like Allen Ginsberg and Jack Kerouac.","Sheraton Palace Hotel (639 Market Street)":"The hotel was destroyed in the 1906 earthquake and fire, had to be rebuilt, and was reopened in 1909. ","Conservatory of Flowers, Golden Gate Park":"The Conservatory, unveiled in 1879, is the oldest public conservatory in the Western Hemisphere.","Vesuvio Café (255 Columbus Avenue)":"Jack Kerouac was a regular at the café.","Telegraph Hill":"Largely untouched by the 1906 earthquake, Telegraph Hill has the most pre-1870 buildings in the city.","The Ferry Building":"Every hour and half-hour, the clock bell atop the Ferry Building chimes portions of the Westminster Quarters.","Administration Building (Treasure Island)":"An artificial island, Treasure Island was created for the 1939 Golden Gate International Exposition, and is named after the novel by Robert Louis Stevenson, a one-time San Francisco resident.","Mark Hopkins Intercontinental Hotel (1 Nob Hill Circle, Nob Hill)":"The Top of the Mark lounge and restaurant at the top of the hotel was formerly a penthouse suite.","United Nations Plaza (Civic Center)":"United Nations Plaza was built in 1975 and across its walkways are white lines into which the preamble to the preamble of the UN charter is carved.","Transamerica Building (600 Montgomery Street at Clay)":"The Pyramid was the tallest skyscraper west of the Mississippi from 1972-1974, until it was surpassed by Los Angeles' Aon Center. ","Hunters Point":"With 23 miles of ladders and 300,000 rivets in each tower, the Golden Gate Bridge was the world's longest span when it opened in 1937.","Chrissy Field":"Chrissy Field was originally an airfield for the Presidio Army Base. ","Washington Square (North Beach)":"Washington Square Park is not actually a square, as it has 5 sides. North Beach is not a beach.","Palace of Fine Arts":"The original Palace was built for the 1915 Panama-Pacific Exposition, and completely destroyed in 1964. It was rebuilt in 1965.","Japanese Tea Garden (Hagiwara Tea Garden Drive, Golden Gate Park)":"The Japanese Hagiwara family invented \"Chinese\" fortune cookies in the tea-garden","Chinatown Gate":"Designed in 1970, the Chinatown Gate (aka the Dragon Gate) is based on ceremonial gates found in Chinese villages. ","722 Steiner Street (Postcard Row, Alamo Square, Hayes Valley)":"The 6 Victorian homes across from Alamo Square Park are among the few Victorians to survive the Great Fire.","Market & Castro Street":"From 1910-1920 the Castro was called \"Little Scandinavia\" because of its high concentration of residents of Scandinavian ancestry.","Barbary Coast":"The Barbary Coast was a red-light district that was largely destroyed in the 1906 earthquake. Though some of the establishments were rebuilt after the earthquake, an anti-vice campaign put the establisments out of business.","Presidio (Golden Gate National Recreation Area)":"In 1776, Spain made the Presido a fortified area. The area was then given to Mexico, but then given to the US in 1848. The 1994 demilitarization of the area in 1994 marked the end of its 219 years of military use. ","Bank of America (38th Street at Balboa Street)":"The Bank of America Building was the tallest building on the West Coast from 1969-1972, when it was surpassed by the TransAmerica Pyramid. Today, the Bank of America building is the 5th tallest building on the West Coast.","Japanese Tea Garden, Hagiwara Tea Garden Drive, Golden Gate Park":"The Japanese Hagiwara family invented \"Chinese\" fortune cookies in the tea-garden","The Music Concourse (Martin Luther King, Jr. Drive, Golden Gate Park)":"Golden Gate Park is similar in shape but 20% larger than New York's Central Park.","Magic Theater (Fort Mason, Golden Gate National Recreation Area)":"Constructed in 1864 as a coastal defense site, Fort Mason went on to serve as an army post for more than 100 years.","Carnelian Room, Bank of America Building (555 California Street, 53rd Floor)":"The Bank of America Building was the tallest building on the West Coast from 1969-1972, when it was surpassed by the TransAmerica Pyramid. Today, the Bank of America building is the 5th tallest building on the West Coast.","Prudente's Italian Deli (1462 Grant Ave at Union)":"Prudente's Italian Deli, which has since closed, is called \"Meats of the World\" in the film.","The Embarcadero/Ferry Building":"Every hour and half-hour, the clock bell atop the Ferry Building chimes portions of the Westminster Quarters.","Mt. Davidson":"Mt. Davidson is highest point in San Francisco (938 feet).","Ferry Plaza":"Every hour and half-hour, the clock bell atop the Ferry Building chimes portions of the Westminster Quarters.","Foote, Cone & Belding (733 Front Street at Pacific)":"The building is called \"Jabe & Dunne Advertising Agency\" in the movie.","Washington Square Park (North Beach)":"Washington Square Park is not actually a square, as it has 5 sides. North Beach is not a beach. The statue in the Park is Ben Franklin, not George Washington.","Sutter-Stockton Garage (330 Sutter Street at Stockton)":"Garage roof serves as a heliport in the movie","Roof of Cable Car (California at Front Street)":"SF Cable Cars are the only moving National Historical Landmark.","Powell and Geary Streets (Union Square)":"The pet shop featured in the film does not exist, but was based on the now-closed Robison's House of Pets formerly located on Maiden Lane.","Alta Plaza Park (Steiner Street)":"The park was originally a rock quarry and served as a campground for many survivors of the 1906 earthquake. The site was converted to a park in 1910.","Alcoa Building (1 Maritime Plaza)":"A partially-above ground parking structure near the building made it necessary for architects to make the Alcoa Building's diagonal bracing visible, instead of placing it inside and drastically reducing the amount usable interior space. ","Stockton Tunnel Southern Approach Overhang (Bush & Stockton Streets, Chinatown)":"Opened in 1914, the Stockton Tunnel was built to provide North Beach residents access to the thriving downtown area.","Mandarin Theatre (1021 Grant Avenue)":"The Mandarin Theatre was renamed the Sun Sing Theatre in 1949. It closed 1986.","100 Block of Lombard Street":"Lombard Street is not actually the crookedest in SF. That honor goes to Potrero Hill's Vermont Street between 22nd and 23rd.","Golden Gate Park Children's Playground ":"Golden Gate Park is similar in shape but 20% larger than New York's Central Park.","Cow Palace":"Suppsedly, the Cow Palace's name derives from a newspaper editorial in which the writer wonders whether the soon-to-be-built structure for livestock was a \"palace for cows\". ","Golden Gate National Recreation Area":"The size of the Recreation Area is over two and a half greater than that of the city and county of San Francisco.","Bank of America Building (555 California Street, Financial District)":"The Bank of America Building was the tallest building on the West Coast from 1969-1972, when it was surpassed by the TransAmerica Pyramid. Today, the Bank of America building is the 5th tallest building on the West Coast.","Lincoln Park":"The land on which the park stands was a cemetary until the late 1860s. ","Huntington Park (California & Taylor Streets, Nob Hill)":"The mansion of Arabella Huntington, widow of railroad magnate Collis P. Huntington, was destroyed in the 1906 earthquake and fire. Mrs. Huntington the donated the land on which the park now stands to the city.","Ghiradelli Square (900 North Point Street, Fisherman's Wharf)":"In 1893, chocolatier Domingo Ghiradelli bought an entire city block to house the headquarters of Ghiradelli Chocolates.","Park Hill Sanatorium (351 Buena Vista Avenue East)":"This location is now a condominium complex.","Ernie's Restaurant (847 Montgomery Street)":"Called the \"Essex Club\" in the film.","California Palace of the Legion of Honor (34th Avenue & Clement, Lincoln Park)":"Built in 1924, the Legion of Honor is a 3/4 replica of the Parisian Palais de la Legion d'Honneur. ","900 Lombard Street":"Lombard Street is not actually the crookedest in SF. That honor goes to Potrero Hill's Vermont Street between 22nd and 23rd.","1007 Gough Street":"Tennis courts now sit on the site; in the movie the structure was Carlota Valdes' home.","Victor's Restaurant, The Westin St. Francis Hotel (335 Powell Street)":"The hotel was originally supposed to be named the Crocker Hotel, after Charles Founder the railroad magnate who founded it. However, the hotel took the name the St. Francis after one of the earliest Gold Rush hotels. ","Cable Car Signal Box (California Street at Powell Street)":"SF Cable Cars are the only moving National Historical Landmark.","835-865 Market Street at 5th Street":"The Emporiaum, a department store, stood in this location. Bloomingdale's is now located here. ","772 Commercial Street at Kearney":"Called \"Man Loh's Oriental Roof Garden\" in the film."}
#     db.locations.find {}, (err, found) ->
#         _.each found, (movie) ->
#             arr = []
#             _.each movie.coords, (loc) ->
#                 if loc?
#                     loc.fun_facts = ""
#                     if (funfacts.hasOwnProperty(loc.title))
#                         loc.fun_facts = funfacts[loc.title]
#                     arr.push loc
#             update(arr, movie.title)
#         res.json success: true

app.get "/dev", (req, res) ->
    db.locations.find {}, (err, found) ->
        newarr = []
        _.each found, (loc) ->
            loc._id = null
            delete loc._id
            newarr.push loc
        db.testing.insert newarr, () ->


app.use (req,res) ->
    res.render "404"